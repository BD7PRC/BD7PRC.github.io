name: 自动更新QSL卡呼号列表
on:
  # 触发条件：当qsl-images文件夹有图片推送/删除时
  push:
    paths:
      - 'qsl-images/*.jpg'
      - 'qsl-images/*.JPG'  # 兼容大写扩展名
  # 手动触发（可选，怕自动失败时用）
  workflow_dispatch:

jobs:
  update-qsl:
    runs-on: ubuntu-latest
    steps:
      # 第一步：拉取仓库代码
      - name: 拉取GitHub仓库代码
        uses: actions/checkout@v4

      # 第二步：扫描qsl-images文件夹，生成呼号列表
      - name: 生成呼号列表
        run: |
          # 进入图片文件夹，提取所有.jpg文件的呼号（去除后缀）
          cd qsl-images
          # 筛选.jpg/.JPG文件，排序后格式化为"呼号1","呼号2",...
          callsigns=$(ls *.jpg *.JPG 2>/dev/null | sed 's/\.[jJ][pP][gG]$//g' | sort | awk '{print "\""$0"\""}' | tr '\n' ',')
          # 移除末尾多余的逗号
          callsigns=${callsigns%,}
          # 将呼号列表写入环境变量，供后续步骤使用
          echo "CALLSIGNS=$callsigns" >> $GITHUB_ENV

      # 第三步：替换qsl.html中的占位符
      - name: 更新qsl.html中的呼号列表
        run: |
          # 用sed命令替换占位符（兼容Linux语法）
          sed -i "s/\/\* AUTO_GENERATED_CALLSIGNS \*\//$CALLSIGNS/" qsl.html

      # 第四步：自动提交更新后的qsl.html
      - name: 自动提交修改
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          # 提交信息（可自定义）
          commit_message: "自动更新QSL卡呼号列表"
          # 只提交修改后的qsl.html
          file_pattern: "qsl.html"
          # 提交者信息（可替换为你的GitHub用户名和邮箱）
          commit_user_name: "GitHub Actions"
          commit_user_email: "actions@github.com"
          commit_author: "GitHub Actions <actions@github.com>"
